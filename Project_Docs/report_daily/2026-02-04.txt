2026-02-04 스마트 건설안전 시스템 개발 일지

============================================================
1. 금일 오전 업무 (AM) - [진행 중]
============================================================
A. 관리자용 근로자 승인 시스템 구축 (Member Approval)
   - [Backend] 프로젝트 멤버 관리 API 구현
     - GET /api/projects/{id}/members?status=PENDING: 승인 대기 인원 조회
     - PATCH /api/projects/{id}/members/approval: 멤버 승인(ACTIVE) 처리
   - [Frontend] 관리자 대시보드 위젯 추가 (MemberApprovalWidget)
     - 대시보드 레이아웃 변경 (3열 -> 2열 그리드) 하여 공간 확보
     - 승인 대기 인원 목록 조회 및 즉시 승인 기능 구현
     - 승인 처리 시 낙관적 업데이트(Optimistic Update)로 UI 즉시 반영

============================================================
2. 금일 오후 업무 (PM) - [계획]
============================================================
A. 지도 API 연동 (Map Integration)
   - 네이버 지도 API 클라이언트 ID 발급 및 환경변수 설정
   - MapContainer 컴포넌트 구현 및 대시보드 연동

B. 작업 계획 프로세스 (Work Plan) 시작
   - 작업 템플릿 DB 시딩
   - 내일의 작업 등록 화면 구현 (Phase 2 진입)

============================================================
3. 특이사항 및 이슈 해결 (DB Unicode Escaping)
============================================================
- 이슈: DB 내 JSON/JSONB 컬럼에 한글 데이터 저장 시 유니코드(\uXXXX)로 이스케이프되어 가독성 저하.
- 원인 분석:
  1. SQLAlchemy의 json_serializer 설정이 asyncpg 드라이버에서 무시됨.
  2. Raw SQL 사용 시 수동으로 json.dumps()를 사용하면서 기본값(ensure_ascii=True) 적용.
- 해결 과정:
  1. back/database.py: SQLAlchemy 엔진 설정에 전역 json_serializer(ensure_ascii=False) 적용.
  2. Hybrid DB Pattern 최적화: 서비스 로직은 Raw SQL 기반으로, 인프라/시딩은 ORM 기반으로 역할 분담.
  3. reset_scenario.py: 모든 시딩 로직을 ORM 방식으로 전환하여 엔진 레벨의 안전한 직렬화 보장.
  4. reset_scenario.py: 삭제 대상 테이블 목록에 work_templates 누락 수정 및 실행부(asyncio.run) 추가.
- 결과: DB 내 모든 한글 데이터가 UTF-8 문자열 그대로 저장되어 DBeaver 등에서 가독성 확보.

============================================================
4. 익일 계획
============================================================
- 위험 경고 엔진 (Risk Engine) 로직 구현.
- 현장 위험도 시각화 (히트맵 등).
- 지도 API 실연동.
