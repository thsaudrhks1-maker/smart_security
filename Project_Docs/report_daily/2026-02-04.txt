2026-02-04 스마트 건설안전 시스템 개발 일지

============================================================
1. 금일 오전 업무 (AM) - [진행 중]
============================================================
A. 관리자용 근로자 승인 시스템 구축 (Member Approval)
   - [Backend] 프로젝트 멤버 관리 API 구현
     - GET /api/projects/{id}/members?status=PENDING: 승인 대기 인원 조회
     - PATCH /api/projects/{id}/members/approval: 멤버 승인(ACTIVE) 처리
   - [Frontend] 관리자 대시보드 위젯 추가 (MemberApprovalWidget)
     - 대시보드 레이아웃 변경 (3열 -> 2열 그리드) 하여 공간 확보
     - 승인 대기 인원 목록 조회 및 즉시 승인 기능 구현
     - 승인 처리 시 낙관적 업데이트(Optimistic Update)로 UI 즉시 반영

B. 데이터베이스 시딩 고도화 (Incremental Seeding) - [완료]
   - 기존 데이터를 보존하며 필요한 데이터만 추가하는 '인크리멘탈(증분)' 방식 도입.
   - `seed/seed_extended_historical.py` 생성:
     - 신규 협력사(대성기계) 및 작업자 10명 추가.
     - 승인 대기(PENDING)와 승인 완료(ACTIVE) 상태를 혼합하여 데이터셋 다양화.
     - 1월 과거 출역 기록(Attendance) 생성하여 통계 데이터 확보.
   - `db_lifecycle_manager` 스킬 업데이트: 증분 시딩 원칙 명문화.

============================================================
2. 금일 오후 업무 (PM) - [완료]
============================================================
A. 작업 안전 관리 고도화 (Safety Resource Management) - [완료]
   - [Model] DailyWorkPlan 모델 확장: 작업별 장비 제외/추가 ID 컬럼 추가.
   - [Data] 정예 안전 장비 15종 정규화: PPE, 중장비, 공구 등 핵심 장비 데이터 구축.
   - [Data] 시딩 로직 최적화: `reset_scenario.py`를 통해 모든 공종과 장비의 N:M 매핑 재구성.

B. 근로자 대시보드 UI/UX 개선 - [완료]
   - [Map] 지도 중첩 표시 오류 수정: 작업 구역과 위험 구역이 일치할 경우의 필드 매핑(zone_id) 정정.
   - [UI] 인터랙티브 체크리스트 구현: 보호구 착용 및 안전 수칙 확인을 위한 체크박스 UI 도입.
   - [API] 맞춤형 안전정보 자동 생성: 근로자의 금일 공종에 기반한 전용 안전 수칙을 '일일 안전정보'에 자동 노출.

C. 출역 관리(Attendance) 대시보드 연동 - [완료]
   - 오늘 및 과거 출역 현황 리스트 조회 API 연동.
   - 대시보드 내 출역 명단 위젯 구현 (AttendanceListWidget).

D. 작업 계획 프로세스 (Work Plan) 안정화 - [완료]
   - DailyWorkPlan CRUD API와 신규 안전 장비 모델 연동 완료.
   - 템플릿 기반 리스크 스코어 계산 로직 검증.

============================================================
3. 특이사항 및 이슈 해결
============================================================
- 이슈 1: DB Unicode Escaping (해결)
  - 원인: SQLAlchemy 엔진의 JSON 직렬화 설정 미흡 및 Raw SQL의 dumps 파라미터 누락.
  - 해결: asyncpg 대응 전역 serializer 적용으로 DB 내 한글 가독성 확보.

- 이슈 2: DailyWorkPlan AttributeError (해결)
  - 원인: 라우터/스키마에는 정의된 필드가 실제 DB 모델(model.py)에는 누락됨.
  - 해결: DailyWorkPlan 및 SafetyResource 모델에 누락된 컬럼(excluded_ids 등) 추가 및 시드 데이터 동기화.

- 이슈 3: 지도 구역 색상 미표시 (해결)
  - 원인: 프론트엔드 지도 컴포넌트가 요구하는 `zone_id` 대신 `id` 필드를 백엔드에서 전송함.
  - 해결: 작업자용 위험 지역 조회 API 응답에 `zone_id` 명시적 추가.

============================================================
4. 익일 계획
============================================================
- 위험 경고 엔진 (Risk Engine) 로직 심화 구현.
- 현장 위험도 시각화 (히트맵 등).
- 관리자용 위험 지역 설정 UI 고도화.
- 실제 현장 도면(Blueprint) 업로드 및 지도 오버레이 테스트.
