2026-02-03 스마트 건설안전 시스템 개발 일지

============================================================
1. 금일 오전 업무 (AM) - [완료]
============================================================
A. 협력사 관리 시스템 구축 (Company Management)
   - [Backend] Company 모델 스키마 수정 (type 컬럼 추가) 및 마이그레이션 완료.
   - [Backend] 협력사 등록 API 구현 (POST /company) 및 중복 체크 로직 적용.
   - [Frontend] admin/companies 페이지 신설 (목록 조회 및 등록 모달).

B. 프로젝트 생성 프로세스 개선 (Create Project)
   - 프로젝트 생성 화면(CreateProject.jsx)에서 발주처/시공사 선택 기능 고도화.
   - [New] 업체 선택 드롭다운 내 "새 업체 등록" 기능 추가 (화면 이동 없이 모달로 즉시 등록).
   - 발주처(Client)와 시공사(Constructor) 구분 로직 적용.

C. 3-Tier 아키텍처 (Role-Based UI) 구현
   - 사용자 역할에 따른 3단계 UI 구조 확립 (Admin / Manager / Worker).
   - [Frontend] features/manager 폴더 신설 및 라우팅(/manager) 적용.
   - [Frontend] 현장 관리자용 레이아웃(ManagerLayout) 및 대시보드(ManagerDashboard) 구현.
     - 스크린샷 기반 UI 적용 (현장현황, QR코드, 운영통계, 공지사항).
   - [Frontend] Admin 사이드바(NavSidebar)에 로그인 유저 정보 연동 및 로그아웃 처리.

============================================================
2. 금일 오후 업무 (PM) - [완료]
============================================================
A. 시스템 안정성 및 데이터 표준화
   - DB 날짜/시간 데이터 타입 처리 표준화 (Date, DateTime 객체 직접 전달 로직 적용).
   - 기존의 불필요한 str() 변환 로직 제거하여 asyncpg DataError 원천 차단.
   - [Backend] safety/model.py 내 누락된 Boolean 임포트 및 모델 정의(EmergencyAlert, SafetyViolation) 추가.

B. 인증 시스템 디버깅 및 CORS 대응
   - [Auth] 토큰 파싱 로직 고도화 (언더바 포함된 특수 유저명 'token_worker_worker' 대응).
   - [Main] 로컬 개발 환경(IP/Port 가변) 대응을 위한 CORS 허용 범위(Regex) 최적화.

C. 근로자 대시보드(Worker Dashboard) 고도화
   - [Logic] 사용자의 소속 회사(company_id) 정보를 기반으로 회사명 상시 노출.
   - [State] 현장 승인 시나리오 구현:
     - project_members 내 상태(PENDING/ACTIVE)에 따라 '현장 승인 대기 중' 문구 분기 처리.
   - [Stability] 대시보드 내 섹션별(날씨, 긴급알림, 점검 등) 개별 try-except 적용하여 특정 테이블 부재 시에도 전체 서비스 유지.

D. DB 초기화 시나리오(reset_scenario.py) 업데이트
   - 신규 추가된 테이블(EmergencyAlert, SafetyViolation) 자동 초기화 및 재생성 로직 포함.
   - 작업자(worker)의 프로젝트 멤버십 상태를 '승인 대기(PENDING)'로 설정하여 실제 운영 시나리오 검증.

============================================================
3. 특이사항 및 이슈 해결
============================================================
- 이슈: 근로자 로그인 후 대시보드 진입 시 UndefinedTableError (emergency_alerts 등) 발생.
- 해결: 모델 추가 및 reset_scenario.py 테이블 목록 동기화, 서비스 레이어 방어 코드 작성.
- 이슈: 특정 브라우저 환경에서 CORS 차단으로 인한 API 호출 실패.
- 해결: allow_origin_regex 설정을 통해 127.0.0.1 및 로컬 네트워크 대역 허용.

============================================================
4. 익일 계획
============================================================
- 현장 관리자용 근로자 승인/관리 기능 UI 구현.
- 네이버 지도 API 연동을 위한 클라이언트 ID 발급 및 기본 지도 레이아웃 배치.
- 작업자 위치 추적 기초 설계 및 실시간 동기화 방식 검토.
